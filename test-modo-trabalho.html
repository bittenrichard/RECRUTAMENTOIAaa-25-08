<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Modo Trabalho</title>
</head>
<body>
    <h1>üß™ Teste do Modo de Trabalho</h1>
    <div id="resultado"></div>
    <button onclick="testarModoTrabalho()">Testar Cria√ß√£o de Vaga</button>
    
    <script>
        const API_BASE_URL = 'http://localhost:3001';
        
        async function testarModoTrabalho() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<p>üß™ Iniciando teste...</p>';
            
            try {
                // 1. Testar conectividade
                resultado.innerHTML += '<p>‚úÖ Testando conectividade...</p>';
                const healthResponse = await fetch(API_BASE_URL + '/health');
                if (healthResponse.ok) {
                    resultado.innerHTML += '<p>‚úÖ Servidor conectado!</p>';
                } else {
                    throw new Error('Servidor indispon√≠vel');
                }
                
                // 2. Criar vaga com modo_trabalho
                resultado.innerHTML += '<p>üì§ Criando vaga com modo_trabalho...</p>';
                const testData = {
                    titulo: 'TESTE MODO TRABALHO BROWSER - ' + Date.now(),
                    descricao: 'Teste via navegador',
                    endereco: 'S√£o Paulo, SP',
                    modo_trabalho: 'remoto',
                    requisitos_json: JSON.stringify({
                        idade: { min: '20', max: '40' },
                        experiencia: '2 anos'
                    }),
                    usuario: [1]
                };
                
                const createResponse = await fetch(API_BASE_URL + '/api/jobs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                if (!createResponse.ok) {
                    const errorText = await createResponse.text();
                    throw new Error(`Erro ao criar vaga: ${createResponse.status} - ${errorText}`);
                }
                
                const createdJob = await createResponse.json();
                resultado.innerHTML += `<p>‚úÖ Vaga criada com ID: ${createdJob.id}</p>`;
                resultado.innerHTML += `<p>üìÑ requisitos_json: ${createdJob.requisitos_json}</p>`;
                
                // Verificar se modo_trabalho foi salvo
                if (createdJob.requisitos_json) {
                    const parsedRequisitos = JSON.parse(createdJob.requisitos_json);
                    resultado.innerHTML += `<p>üîç modo_trabalho extra√≠do: ${parsedRequisitos.modo_trabalho}</p>`;
                    
                    if (parsedRequisitos.modo_trabalho === 'remoto') {
                        resultado.innerHTML += '<p style="color: green;">üéâ SUCESSO: modo_trabalho foi salvo no requisitos_json!</p>';
                    } else {
                        resultado.innerHTML += '<p style="color: red;">‚ùå FALHA: modo_trabalho n√£o foi salvo corretamente</p>';
                        return;
                    }
                }
                
                // 3. Testar recupera√ß√£o de dados
                resultado.innerHTML += '<p>üìä Testando recupera√ß√£o de dados...</p>';
                const allDataResponse = await fetch(API_BASE_URL + '/api/data/all/1');
                if (!allDataResponse.ok) {
                    throw new Error('Erro ao recuperar dados');
                }
                
                const allData = await allDataResponse.json();
                resultado.innerHTML += '<p>‚úÖ Dados recuperados!</p>';
                
                // Procurar nossa vaga criada
                const ourJob = allData.jobs?.find(job => job.id === createdJob.id);
                if (ourJob) {
                    resultado.innerHTML += '<p>üîç Vaga encontrada nos dados recuperados</p>';
                    resultado.innerHTML += `<p>üìÑ modo_trabalho extra√≠do: ${ourJob.modo_trabalho}</p>`;
                    
                    if (ourJob.modo_trabalho === 'remoto') {
                        resultado.innerHTML += '<p style="color: green;">‚úÖ modo_trabalho extra√≠do corretamente do requisitos_json!</p>';
                    } else {
                        resultado.innerHTML += '<p style="color: red;">‚ùå modo_trabalho n√£o foi extra√≠do corretamente</p>';
                    }
                }
                
                resultado.innerHTML += '<p style="color: green; font-weight: bold;">üéâ TESTE CONCLU√çDO COM SUCESSO!</p>';
                resultado.innerHTML += '<p>üìù Resumo: modo_trabalho est√° sendo salvo e recuperado corretamente em requisitos_json</p>';
                
            } catch (error) {
                resultado.innerHTML += `<p style="color: red;">‚ùå Erro no teste: ${error.message}</p>`;
                console.error('Erro completo:', error);
            }
        }
    </script>
</body>
</html>